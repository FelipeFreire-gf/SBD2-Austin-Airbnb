# Entrega 2 - Gold

## Descrição da Medição

### Objetivo
Criar a camada **Gold** da arquitetura Medallion, contendo dados agregados, métricas de negócio e visualizações analíticas prontas para consumo pelo dashboard Power BI.

### Camada Gold - Visão Geral

A camada Gold representa os dados otimizados para análise e visualização, com:
- Agregações pré-calculadas
- Métricas de negócio consolidadas
- Modelagem dimensional (Star Schema)
- Views materializadas para performance

### Análises Implementadas

#### 1. Análise de Correlação
**Objetivo:** Identificar relações entre diferentes tipos de atrasos

**Métricas analisadas:**
- Atraso da companhia
- Atraso meteorológico
- Atraso NAS
- Atraso de aeronave atrasada
- Voos cancelados
- Voos desviados

**Insights:**
- Matriz de correlação mostrando interdependências
- Identificação de causas predominantes

#### 2. Performance por Companhia Aérea
**Objetivo:** Ranquear companhias por atraso médio

**Métricas:**
- Atraso médio de chegada por companhia
- Número total de voos por companhia
- Taxa de atrasos ≥15 minutos

**Visualização:** Gráfico de barras horizontais ordenado

#### 3. Impacto Meteorológico
**Objetivo:** Analisar sazonalidade dos atrasos por condições climáticas

**Métricas:**
- Contagem mensal de atrasos meteorológicos
- Identificação de meses críticos
- Padrões sazonais

**Visualização:** Gráfico de barras por mês

#### 4. Análise de Sazonalidade (Comparativo Anual)
**Objetivo:** Validar a recorrência de padrões sazonais e identificar anos anômalos comparando as curvas mensais de cada ano sobrepostas.

**Métricas:**
- Eixo X: Meses (Jan-Dez)
- Eixo Y: Taxa de Atraso (%) ou Média de Minutos
- Legenda: Anos (2013-2023)

**Visualização:** Gráfico de Linhas Múltiplas (Spaghetti Plot)

**Insight:** Distinguir padrões estruturais (ex: picos de verão recorrentes) de eventos pontuais e visualizar o impacto da pandemia (2020) na curva padrão.

#### 5. Tendência Temporal
**Objetivo:** Analisar evolução dos atrasos ao longo do tempo
#### 5. Tendência Temporal e Decomposição (STL)
**Objetivo:** Analisar a evolução histórica e decompor a série em seus componentes fundamentais (Tendência, Sazonalidade, Ruído).

**Componentes:**
- Tendência geral
- Sazonalidade
- Resíduo
- Decomposição sazonal (STL)
- **Original:** Série bruta mensal de `arr_delay` (soma de minutos) ou Taxa de Atraso.
- **Tendência:** Direção de longo prazo (suavizada).
- **Sazonalidade:** Padrão cíclico recorrente (12 meses).
- **Resíduo:** Eventos aleatórios ou anomalias (ex: impacto COVID-19).

**Visualizações:**
- Gráfico de linha temporal
- Decomposição sazonal (4 painéis)
- Gráfico de Linha Temporal (Evolução simples)
- Painel de Decomposição STL (4 gráficos verticais)

**Insight:** Isolar variações sazonais para entender se a performance estrutural do setor está melhorando ou piorando, e identificar anomalias exógenas nos resíduos.

#### 6. Causas de Atrasos (Breakdown Temporal)
**Objetivo:** Detalhar contribuição de cada causa

**Breakdown por causa:**
- Companhia aérea
- Condições meteorológicas
- Sistema de Aviação Nacional (NAS)
- Segurança
- Aeronave atrasada

**Visualização:** Grid 2x2 com tendências mensais

#### 7. Contribuição Média das Causas
**Objetivo:** Determinar a representatividade percentual de cada categoria de causa no tempo total de atraso.

**Métricas:**
- Soma total de minutos por causa
- Percentual relativo do total

**Visualização:** Gráfico de Rosca (Donut Chart)

**Insight:** Revelar que causas logísticas (NAS, Late Aircraft) frequentemente superam causas climáticas em volume total de tempo perdido.

#### 8. Distribuição de Features Numéricas
**Objetivo:** Caracterizar o comportamento estatístico dos dados, confirmando a assimetria e a presença de outliers.

**Métricas analisadas:**
- `arr_delay` (filtrado para > 0 para focar na severidade)
- Comparação entre componentes (`weather_delay` vs `carrier_delay`, etc.)

**Visualização:** Painel de Histogramas com KDE e Boxplots

**Insight:** Identificar a "cauda longa" da distribuição, diferenciando causas que geram muitos atrasos curtos de causas que geram eventos raros mas catastróficos.

#### 9. Top Rankings Categóricos
**Objetivo:** Identificar aeroportos e companhias mais relevantes

**Rankings:**
- Top 15 códigos de companhias
- Top 15 nomes de companhias
- Top 15 códigos de aeroportos
- Top 15 nomes de aeroportos

**Visualização:** Gráficos de barras

### Modelagem Dimensional (Star Schema)

#### Tabelas Dimensão
1. **dim_carrier** (Companhias Aéreas)
   - carrier_id (PK)
   - carrier_code
   - carrier_name

2. **dim_airport** (Aeroportos)
   - airport_id (PK)
   - airport_code
   - airport_name
   - city
   - state

3. **dim_time** (Temporal)
   - time_id (PK)
   - year
   - month
   - quarter
   - season

4. **dim_delay_cause** (Causas de Atrasos)
   - cause_id (PK)
   - cause_name
   - cause_category

#### Tabela Fato
**fact_flight_delays** (Fato de Atrasos)
- flight_delay_id (PK)
- time_id (FK)
- carrier_id (FK)
- airport_id (FK)
- arr_flights (medida)
- arr_del15 (medida)
- arr_delay (medida)
- arr_cancelled (medida)
- arr_diverted (medida)
- carrier_delay (medida)
- weather_delay (medida)
- nas_delay (medida)
- security_delay (medida)
- late_aircraft_delay (medida)

### Métricas de Negócio

| Métrica | Fórmula | Descrição |
|---------|---------|-----------|
| Taxa de Atraso | (arr_del15 / arr_flights) × 100 | % de voos atrasados ≥15min |
| Taxa de Cancelamento | (arr_cancelled / arr_flights) × 100 | % de voos cancelados |
| Taxa de Desvio | (arr_diverted / arr_flights) × 100 | % de voos desviados |
| Atraso Médio | arr_delay / arr_flights | Minutos médios de atraso |
| Pontualidade | 100 - Taxa de Atraso | % de voos no horário |

### Views Materializadas

```sql
-- View: Top Aeroportos com Atrasos
CREATE MATERIALIZED VIEW gold.top_delayed_airports AS
SELECT 
    airport_name,
    SUM(arr_del15) as total_delays,
    AVG(arr_delay) as avg_delay_minutes,
    ROUND((SUM(arr_del15)::decimal / SUM(arr_flights)) * 100, 2) as delay_rate
FROM silver.airline_delays
GROUP BY airport_name
ORDER BY total_delays DESC
LIMIT 20;

-- View: Performance Mensal por Companhia
CREATE MATERIALIZED VIEW gold.carrier_monthly_performance AS
SELECT 
    year, month,
    carrier_name,
    SUM(arr_flights) as total_flights,
    SUM(arr_del15) as total_delays,
    AVG(arr_delay) as avg_delay,
    SUM(arr_cancelled) as total_cancelled
FROM silver.airline_delays
GROUP BY year, month, carrier_name;
```

### Arquivos Relacionados

- **Analytics Silver**: `/Data Layer/silver/analytics.ipynb`
- **Analytics Raw**: `/Data Layer/raw/analytics.ipynb`

### Ferramentas de Visualização

| Ferramenta | Uso |
|------------|-----|
| **Matplotlib** | Gráficos básicos e customizados |
| **Seaborn** | Visualizações estatísticas |
| **Pandas** | Manipulação e agregação de dados |
| **Statsmodels** | Decomposição sazonal |

### Padrões de Qualidade

- Dados agregados consistentes
- Métricas validadas com dados originais
- Visualizações claras e informativas
- Performance otimizada para dashboards

### Próximos Passos

1. Conectar camada Gold ao Power BI
2. Criar dashboards interativos
3. Implementar alertas de anomalias
4. Automatizar refresh das views materializadas
