# Entrega 3 - Power BI

## Execução da Medição

### Objetivo
Desenvolver dashboard interativo no **Power BI** para visualização e análise dos dados de atrasos de voos, permitindo exploração dinâmica e geração de insights de negócio.

### Arquitetura de Conexão

```
PostgreSQL (silver.airline_delays)
        ↓
    Power BI Desktop
        ↓
    Dashboard Interativo
        ↓
    Power BI Service (Publicação)
```

### Configuração de Conexão

#### 1. Conexão ao PostgreSQL

**Credenciais:**
- **Host:** localhost (ou IP do container Docker)
- **Porta:** 5432
- **Database:** airline_delays
- **Schema:** silver
- **Tabela:** airline_delays
- **Usuário:** postgres
- **Senha:** postgres

**String de Conexão:**
```
Server=localhost;Database=airline_delays;UID=postgres;PWD=postgres
```

#### 2. Importação de Dados

**Modo recomendado:** Import (para melhor performance)
**Alternativa:** DirectQuery (para dados em tempo real)

**Query SQL:**
```sql
SELECT 
    year, month,
    carrier, carrier_name,
    airport, airport_name,
    arr_flights, arr_del15,
    carrier_ct, weather_ct, nas_ct, security_ct, late_aircraft_ct,
    arr_cancelled, arr_diverted,
    arr_delay, carrier_delay, weather_delay, nas_delay, security_delay, late_aircraft_delay
FROM silver.airline_delays
ORDER BY year, month, carrier, airport
```

### Estrutura do Dashboard

#### Página 1: Visão Geral (Overview)
**KPIs Principais:**
- Total de Voos
- Atraso Médio (minutos)
- Taxa de Cancelamento (%)
- Taxa de Pontualidade (%)

**Visualizações:**
1. **Card de Métricas** - KPIs principais
2. **Gráfico de Linha** - Tendência temporal de atrasos
3. **Mapa** - Distribuição geográfica por aeroporto
4. **Gráfico de Barras** - Top 10 aeroportos com mais atrasos

**Filtros:**
- Seletor de ano
- Seletor de mês
- Seletor de companhia aérea

#### Página 2: Análise por Companhia Aérea
**Visualizações:**
1. **Tabela** - Ranking de companhias por performance
2. **Gráfico de Barras Horizontais** - Atraso médio por companhia
3. **Gráfico de Dispersão** - Relação entre volume de voos e atrasos
4. **Treemap** - Participação de mercado

**Métricas:**
- Volume de voos por companhia
- Atraso médio por companhia
- Taxa de cancelamento por companhia
- Evolução temporal

#### Página 3: Causas de Atrasos
**Visualizações:**
1. **Gráfico de Pizza** - Distribuição das causas de atraso
2. **Gráfico de Barras Empilhadas** - Causas por mês
3. **Gráfico de Área** - Evolução temporal das causas
4. **Matriz** - Causas × Companhias

**Categorias:**
- Companhia Aérea (carrier_delay)
- Meteorologia (weather_delay)
- NAS - Sistema Nacional (nas_delay)
- Segurança (security_delay)
- Aeronave Atrasada (late_aircraft_delay)

#### Página 4: Análise Temporal e Sazonalidade
**Visualizações:**
1. **Gráfico de Linhas Múltiplas** - Comparação ano a ano
2. **Heatmap Calendário** - Atrasos por dia/mês
3. **Gráfico de Barras** - Sazonalidade mensal
4. **Decomposição** - Tendência, sazonalidade, resíduo

**Insights:**
- Meses com mais atrasos
- Padrões sazonais
- Tendências de longo prazo

#### Página 5: Análise por Aeroporto
**Visualizações:**
1. **Tabela Interativa** - Detalhes por aeroporto
2. **Mapa Interativo** - Localização e tamanho por volume
3. **Gráfico de Barras** - Top/Bottom aeroportos
4. **Cartões** - Estatísticas do aeroporto selecionado

**Filtros Dinâmicos:**
- Busca de aeroporto
- Filtro por região/estado
- Filtro por volume de operações

### Medidas DAX Criadas

```dax
-- Taxa de Atraso
Taxa de Atraso = 
DIVIDE(
    SUM(airline_delays[arr_del15]),
    SUM(airline_delays[arr_flights]),
    0
) * 100

-- Atraso Médio
Atraso Médio = 
DIVIDE(
    SUM(airline_delays[arr_delay]),
    SUM(airline_delays[arr_flights]),
    0
)

-- Taxa de Pontualidade
Taxa de Pontualidade = 100 - [Taxa de Atraso]

-- Taxa de Cancelamento
Taxa de Cancelamento = 
DIVIDE(
    SUM(airline_delays[arr_cancelled]),
    SUM(airline_delays[arr_flights]),
    0
) * 100

-- Total de Voos
Total de Voos = SUM(airline_delays[arr_flights])

-- Causa Principal
Causa Principal = 
VAR MaxDelay = 
    MAX(
        airline_delays[carrier_delay],
        airline_delays[weather_delay],
        airline_delays[nas_delay],
        airline_delays[security_delay],
        airline_delays[late_aircraft_delay]
    )
RETURN
    SWITCH(
        TRUE(),
        MaxDelay = airline_delays[carrier_delay], "Companhia",
        MaxDelay = airline_delays[weather_delay], "Meteorologia",
        MaxDelay = airline_delays[nas_delay], "NAS",
        MaxDelay = airline_delays[security_delay], "Segurança",
        MaxDelay = airline_delays[late_aircraft_delay], "Aeronave Atrasada",
        "N/A"
    )

-- Ranking de Companhias
Rank Companhia = 
RANKX(
    ALL(airline_delays[carrier_name]),
    [Atraso Médio],
    ,
    DESC,
    DENSE
)
```

### Tabelas Calculadas

```dax
-- Calendário
Calendário = 
CALENDAR(
    DATE(MIN(airline_delays[year]), 1, 1),
    DATE(MAX(airline_delays[year]), 12, 31)
)

-- Dimensão de Causas
Dim_Causas = 
DATATABLE(
    "Causa", STRING,
    "Cor", STRING,
    {
        {"Companhia", "#FF6B6B"},
        {"Meteorologia", "#4ECDC4"},
        {"NAS", "#45B7D1"},
        {"Segurança", "#FFA07A"},
        {"Aeronave Atrasada", "#98D8C8"}
    }
)
```

### Formatação e Design

**Tema de Cores:**
- Primária: Azul Aviação (#0078D4)
- Secundária: Cinza Escuro (#424242)
- Destaque: Laranja (#FF8C00)
- Sucesso: Verde (#28A745)
- Alerta: Vermelho (#DC3545)

**Fontes:**
- Títulos: Segoe UI Bold, 18pt
- Subtítulos: Segoe UI Semibold, 14pt
- Texto: Segoe UI, 11pt

**Layout:**
- Grid 12 colunas
- Espaçamento consistente
- Navegação por botões
- Tooltips informativos

### Interatividade

**Recursos Implementados:**
- Cross-filtering entre visuais
- Drill-down em hierarquias (Ano → Mês → Dia)
- Tooltips personalizados com métricas adicionais
- Botões de navegação entre páginas
- Bookmark para cenários salvos
- Filtros sincronizados entre páginas

### Performance e Otimização

**Técnicas Aplicadas:**
1. **Agregações** - Pré-cálculo de somas e médias
2. **Relacionamentos Otimizados** - Star schema
3. **Medidas Eficientes** - DAX otimizado
4. **Redução de Cardinalidade** - Filtros aplicados na importação
5. **Visualizações Leves** - Limitação de pontos de dados

### Publicação

**Power BI Service:**
1. Publicar no workspace
2. Configurar gateway (se necessário)
3. Agendar refresh automático
4. Compartilhar com stakeholders
5. Configurar permissões

**Refresh Schedule:**
- Frequência: Diária
- Horário: 06:00 AM
- Fuso horário: America/Sao_Paulo

### Documentação do Dashboard

**Manual do Usuário:**
1. Como navegar entre páginas
2. Como usar filtros
3. Interpretação de métricas
4. Glossário de termos

**Guia de Manutenção:**
1. Como atualizar dados
2. Como modificar medidas
3. Como adicionar novas visualizações
4. Troubleshooting comum

### Métricas de Sucesso

- Dashboard carrega em < 5 segundos
- Todas as visualizações são interativas
- Dados atualizados automaticamente
- Mobile-friendly (responsive)
- Acessível a todos os stakeholders

### Próximos Passos

1. Versão mobile otimizada
2. Integração com Q&A (IA do Power BI)
3. Análise preditiva (forecasting)
4. Alertas automáticos por email
5. Embed em portal corporativo

### Links Úteis

- **Dashboard**: [Link será adicionado após publicação]
- **Documentação Power BI**: [Microsoft Learn](https://learn.microsoft.com/power-bi/)
- **Repositório**: [GitHub](https://github.com/FelipeFreire-gf/SBD2-Airline_Delay_Cause)
